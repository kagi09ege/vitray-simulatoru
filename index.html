<!DOCTYPE html>
<html>
<head>
    <title>Vitray Işık Simülasyonu</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 20px; }
        button { 
            padding: 12px 24px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #output { margin: 20px; min-height: 300px; border: 1px dashed #ccc; padding: 10px; }
        #plot { max-width: 100%; }
    </style>
</head>
<body>
    <h1>🎨 Vitray Işık Simülasyonu</h1>
    <button onclick="runSimulation()">SIMÜLASYONU BAŞLAT</button>
    <div id="output">
        <p>Sonuçlar burada görünecek...</p>
        <img id="plot" style="display:none;">
    </div>

<script>
    async function runSimulation() {
        const output = document.getElementById("output");
        output.innerHTML = "⏳ Pyodide yükleniyor... (Lütfen bekleyiniz)";
        
        // Pyodide'i yükle
        let pyodide = await loadPyodide({
            stdout: (text) => output.innerHTML += `<br>${text}`,
            stderr: (text) => output.innerHTML += `<br><span style="color:red">${text}</span>`
        });
        
        await pyodide.loadPackage(["matplotlib", "numpy"]);
        
        // Python kodu
        try {
            await pyodide.runPython(`
                import matplotlib.pyplot as plt
                import numpy as np
                from js import document
                import io, base64
                
                # Vitray simülasyonu
                x = np.linspace(0, 10, 100)
                y = np.sin(x) * np.cos(x*0.5) * 10 + 20
                
                # Grafik oluştur
                plt.figure(figsize=(8,4))
                plt.fill_between(x, y, color='purple', alpha=0.7)
                plt.title("Vitray Işık Dağılımı")
                plt.grid(True)
                
                # HTML'e aktar
                buf = io.BytesIO()
                plt.savefig(buf, format='png')
                buf.seek(0)
                img_data = f"data:image/png;base64,{base64.b64encode(buf.read()).decode('utf-8')}"
                plt.close()
                
                # JavaScript'e grafik gönder
                img = document.createElement("img")
                img.src = img_data
                document.getElementById("output").appendChild(img)
            `);
        } catch (error) {
            output.innerHTML += `<br><span style="color:red">Hata: ${error}</span>`;
        }
    }
</script>
</body>
</html>
